<?php

$params = getopt('', [
    'project-name:'
]);

$projectName = $params['project-name'];

$configFile = <<<FILE
<?php

return [
    'connection' => [
        'driver' => 'mysql',
        'host' => 'localhost',
        'dbname' => '',
        'user' => 'root',
        'pass' => '',
    ],
    // ... another db connection
];
FILE;

$rawQueryFile = <<<FILE
<?php

namespace $projectName\\models;

use $projectName\\records\\ActiveRecord;

class RawQuery extends ActiveRecord
{
    public function query()
    {
        return 'raw_query';
    }

    public function table()
    {
        return null;
    }

    public function fields()
    {
        return [];
    }

    public function view()
    {
        return \$this->select([
            '2 * 2',
            "'Yuriy' as author",
        ]);
    }
}
FILE;

$subQueryFile = <<<FILE
<?php

namespace $projectName\\models;

use $projectName\\records\\ActiveRecord;

class SubQuery extends ActiveRecord
{
    public function query()
    {
        return 'sub_query';
    }

    public function table()
    {
        return User::all();
    }

    public function fields()
    {
        return [];
    }
}
FILE;

$userFile = <<<FILE
<?php

namespace $projectName\\models;

use $projectName\\records\\ActiveRecord;

class User extends ActiveRecord
{
    public function table()
    {
        return 'users';
    }

    public function fields()
    {
        return [];
    }
}
FILE;

$userViewFile = <<<FILE
<?php

namespace $projectName\\models;

use $projectName\\records\\ActiveRecord;

class UserView extends ActiveRecord
{
    public function query()
    {
        return 'user_view';
    }

    public function table()
    {
        return 'users';
    }

    public function fields()
    {
        return [];
    }

    public function view()
    {
        return
            \$this
                ->join('user_group')
                ->join('groups')
                    ->select([
                        'name',
                    ]);
    }
}
FILE;

$customModifierFile = <<<FILE
<?php

namespace $projectName\\modifiers;

use $projectName\\modifier\\field\\SQLCaseModifier;

class CustomModifier extends SQLCaseModifier
{
    public static function mod_custom_one(\$ofield, \$params)
    {
        // ... Code here
    }
}
FILE;

$activeRecordFile = <<<FILE
<?php

namespace $projectName\\records;

use suql\\syntax\\SuQL;
use $projectName\\modifiers\\CustomModifier;
use suql\\db\\Container;

abstract class ActiveRecord extends SuQL
{
    protected static \$schemeClass = '$projectName\\\\schema\\\\AppScheme';
    protected static \$builderClass = 'suql\\\\builder\\\\MySQLBuilder';

    protected function modifierList()
    {
        return array_merge(
            parent::modifierList(),
            [
                CustomModifier::class,
            ]
        );
    }

    public function getDb()
    {
        return Container::get('connection');
    }
}
FILE;

$appSchemeFile = <<<FILE
<?php

namespace $projectName\\schema;

use suql\\core\\Scheme;

class AppScheme extends Scheme
{
    function __construct()
    {
        // \$this->rel('users', 'user_group', 'users.id = user_group.user_id');
    }
}
FILE;

mkdir($projectName, 0700);

mkdir("$projectName/config", 0700);
file_put_contents("$projectName/config/db.php", $configFile);

mkdir("$projectName/models", 0700);
file_put_contents("$projectName/models/RawQuery.php", $rawQueryFile);
file_put_contents("$projectName/models/SubQuery.php", $subQueryFile);
file_put_contents("$projectName/models/User.php", $userFile);
file_put_contents("$projectName/models/UserView.php", $userViewFile);

mkdir("$projectName/modifiers", 0700);
file_put_contents("$projectName/modifiers/CustomModifier.php", $customModifierFile);

mkdir("$projectName/records", 0700);
file_put_contents("$projectName/records/ActiveRecord.php", $activeRecordFile);

mkdir("$projectName/schema", 0700);
file_put_contents("$projectName/schema/AppScheme.php", $appSchemeFile);